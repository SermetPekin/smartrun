name: smartrunâ€‘pypiâ€‘smokeâ€‘test

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  smoke:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10", "3.11", "3.12"]

    steps:
      - name: ğŸ›ï¸  Checkout (optional)
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: "pip"

      - name: ğŸ“¦ Install latest smartrun from PyPI
        run: |
          python -m pip install --upgrade pip
          python -m pip install 'smartrun[jupyter]'

      - name: ğŸ” Show versions
        run: |
          python -V
          smartrun --version

      # ------------------------------------------------------------------ #
      # Smokeâ€‘tests                                                        #
      # ------------------------------------------------------------------ #

      - name: ğŸš€ Run a tiny Python script with smartrun
        run: |
          echo "print('hello workflow')" > hello.py
          smartrun hello.py

      - name: ğŸ“¥ Install packages via smartrun
        run: smartrun install pandas,rich

      - name: â• Add an extra package
        run: smartrun add requests

      - name: ğŸ“— Generate & run a minimal notebook
        run: |
          python - <<'PY'
          import nbformat as nbf, subprocess, pathlib
          nb = nbf.v4.new_notebook()
          nb.cells.append(nbf.v4.new_code_cell("print('notebook ok')"))
          path = pathlib.Path("demo.ipynb")
          nbf.write(nb, path)
          subprocess.run(["smartrun", str(path)], check=True)
          PY
